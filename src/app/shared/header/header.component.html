<header class="header">
  <div class="container-fluid">
    <div class="row align-items-center">
      <div class="col">
        <button class="btn btn-link text-dark d-md-none">
          <i class="bi bi-list fs-4"></i>
        </button>

        <div class="search-box d-none d-md-inline-block">
          <i class="bi bi-search"></i>
          <input type="text" placeholder="Ctrl + K" class="form-control" />
        </div>
      </div>

      <div class="col-auto">
        <div class="d-flex align-items-center gap-3">
          <!-- üë§ User menu -->
          <div class="user-menu-wrapper">
            <div class="user-profile" (click)="toggleMenu()">
              <ng-container *ngIf="avatarUrl; else noAvatar">
                <img [src]="avatarUrl" alt="User" class="user-avatar" />
              </ng-container>
              <ng-template #noAvatar>
                <div class="user-avatar-fallback">{{ userInitial }}</div>
              </ng-template>

              <span class="ms-2 d-none d-md-inline">{{ user?.username }}</span>
            </div>

            <!-- üîΩ Dropdown -->
            <div
              class="dropdown-menu-custom"
              *ngIf="isMenuOpen"
              (click)="$event.stopPropagation()"
            >
              <div class="dropdown-header">
                <strong>{{ user?.firstName }} {{ user?.lastName }}</strong><br />
                <small class="text-muted">{{ user?.email }}</small>
              </div>
              <div class="dropdown-upload">
                <button type="button" class="btn btn-sm btn-outline-secondary" (click)="$event.stopPropagation(); triggerAvatarSelect()">
                  <i class="bi bi-camera"></i> ƒê·ªïi avatar
                </button>
                <!-- hidden file input -->
                <input #avatarInput type="file" accept="image/*" style="display:none" (change)="onAvatarSelected($event)" />
              </div>
              <ul>
                <li (click)="viewProfile()">
                  <i class="bi bi-person-circle"></i> Th√¥ng tin t√†i kho·∫£n
                </li>
                <li (click)="editProfile()">
                  <i class="bi bi-pencil-square"></i> Ch·ªânh s·ª≠a th√¥ng tin
                </li>
                <li (click)="changePassword()">
                  <i class="bi bi-lock"></i> ƒê·ªïi m·∫≠t kh·∫©u
                </li>
                <li (click)="logout()" class="logout">
                  <i class="bi bi-box-arrow-right"></i> ƒêƒÉng xu·∫•t
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</header>

<!-- ============================= -->
<!-- üìÑ Modal: Xem th√¥ng tin t√†i kho·∫£n -->
<!-- ============================= -->
<div class="modal-backdrop" *ngIf="showProfileModal" (click)="closeModals()"></div>
<div class="modal-box" *ngIf="showProfileModal">
  <div class="modal-header">
    <h5>Th√¥ng tin t√†i kho·∫£n</h5>
    <button class="btn-close" (click)="closeModals()"></button>
  </div>
  <div class="modal-body" *ngIf="user">
    <p><strong>Username:</strong> {{ user.username }}</p>
    <p><strong>Email:</strong> {{ user.email }}</p>
    <p><strong>H·ªç t√™n:</strong> {{ user.firstName }} {{ user.lastName }}</p>
    <p><strong>Tr·∫°ng th√°i:</strong> {{ user.status }}</p>
  </div>
</div>

<!-- ============================= -->
<!-- ‚úèÔ∏è Modal: Ch·ªânh s·ª≠a th√¥ng tin -->
<!-- ============================= -->
<div class="modal-backdrop" *ngIf="showEditModal" (click)="closeModals()"></div>
<div class="modal-box" *ngIf="showEditModal">
  <div class="modal-header">
    <h5>Ch·ªânh s·ª≠a th√¥ng tin</h5>
    <button class="btn-close" (click)="closeModals()"></button>
  </div>
  <div class="modal-body">
    <form>
      <div class="mb-2">
        <label>Email:</label>
        <input [(ngModel)]="user!.email" name="email" class="form-control" />
      </div>
      <div class="mb-2">
        <label>H·ªç:</label>
        <input [(ngModel)]="user!.firstName" name="firstName" class="form-control" />
      </div>
      <div class="mb-2">
        <label>T√™n:</label>
        <input [(ngModel)]="user!.lastName" name="lastName" class="form-control" />
      </div>
      <button
        type="button"
        class="btn btn-primary"
        (click)="updateProfile()"
      >
        L∆∞u thay ƒë·ªïi
      </button>
    </form>
  </div>
</div>

<!-- ============================= -->
<!-- üîê Modal: ƒê·ªïi m·∫≠t kh·∫©u -->
<!-- ============================= -->
<div class="modal-backdrop" *ngIf="showChangePasswordModal" (click)="closeModals()"></div>
<div class="modal-box" *ngIf="showChangePasswordModal">
  <div class="modal-header">
    <h5>ƒê·ªïi m·∫≠t kh·∫©u</h5>
    <button class="btn-close" (click)="closeModals()"></button>
  </div>
  <div class="modal-body">
    <form>
      <div class="mb-2">
        <label>M·∫≠t kh·∫©u c≈©</label>
          <input type="password" class="form-control" [(ngModel)]="oldPassword" name="oldPassword"/>
      </div>
      <div class="mb-2">
        <label>M·∫≠t kh·∫©u m·ªõi</label>
          <input type="password" class="form-control" [(ngModel)]="newPassword" name="newPassword"/>
      </div>
      <div class="mb-2">
        <label>X√°c nh·∫≠n m·∫≠t kh·∫©u m·ªõi</label>
          <input type="password" class="form-control" [(ngModel)]="confirmPassword" name="confirmPassword"/>
      </div>
<button type="button" class="btn btn-success" 
        (click)="changePasswordTest(oldPassword, newPassword, confirmPassword)">
  ƒê·ªïi m·∫≠t kh·∫©u
</button>    </form>
  </div>
</div>
