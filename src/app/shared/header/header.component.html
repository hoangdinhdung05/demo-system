<header class="header">
  <div class="container-fluid">
    <div class="row align-items-center">
      <div class="col">
        <button class="btn btn-link text-dark d-md-none">
          <i class="bi bi-list fs-4"></i>
        </button>

        <div class="search-box d-none d-md-inline-block">
          <i class="bi bi-search"></i>
          <input type="text" placeholder="Ctrl + K" class="form-control" />
        </div>
      </div>

      <div class="col-auto">
        <div class="d-flex align-items-center gap-3">
          <!-- User menu -->
          <div class="user-menu-wrapper">
            <div class="user-profile" (click)="toggleMenu()">
              <ng-container *ngIf="avatarUrl; else noAvatar">
                <img [src]="avatarUrl" alt="User" class="user-avatar" />
              </ng-container>
              <ng-template #noAvatar>
                <div class="user-avatar-fallback">{{ userInitial }}</div>
              </ng-template>

              <span class="ms-2 d-none d-md-inline">{{ user?.username }}</span>
            </div>

            <!-- Dropdown -->
            <div
              class="dropdown-menu-custom"
              *ngIf="isMenuOpen"
              (click)="$event.stopPropagation()"
            >
              <div class="dropdown-header">
                <strong>{{ user?.firstName }} {{ user?.lastName }}</strong><br />
                <small class="text-muted">{{ user?.email }}</small>
              </div>
              <ul>
                <li (click)="$event.stopPropagation(); triggerAvatarSelect()">
                  <i class="bi bi-camera"></i> Đổi avatar
                </li>
                <li (click)="viewProfile()">
                  <i class="bi bi-person-circle"></i> Thông tin tài khoản
                </li>
                <li (click)="editProfile()">
                  <i class="bi bi-pencil-square"></i> Chỉnh sửa thông tin
                </li>
                <li (click)="changePassword()">
                  <i class="bi bi-lock"></i> Đổi mật khẩu
                </li>
                <li (click)="logout()" class="logout">
                  <i class="bi bi-box-arrow-right"></i> Đăng xuất
                </li>
              </ul>
              <!-- hidden file input -->
              <input #avatarInput type="file" accept="image/*" style="display:none" (change)="onAvatarSelected($event)" />
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</header>

<!-- ============================= -->
<!-- Modal: Xem thông tin tài khoản -->
<!-- ============================= -->
<div class="modal-backdrop" *ngIf="showProfileModal" (click)="closeModals()"></div>
<div class="modal-box" *ngIf="showProfileModal">
  <div class="modal-header">
    <h5>Thông tin tài khoản</h5>
    <button class="btn-close" (click)="closeModals()"></button>
  </div>
  <div class="modal-body" *ngIf="user">
    <p><strong>Username:</strong> {{ user.username }}</p>
    <p><strong>Email:</strong> {{ user.email }}</p>
    <p><strong>Họ tên:</strong> {{ user.firstName }} {{ user.lastName }}</p>
    <p><strong>Trạng thái:</strong> {{ user.status }}</p>
  </div>
</div>

<!-- ============================= -->
<!-- Modal: Chỉnh sửa thông tin -->
<!-- ============================= -->
<div class="modal-backdrop" *ngIf="showEditModal" (click)="closeModals()"></div>
<div class="modal-box" *ngIf="showEditModal">
  <div class="modal-header">
    <h5>Chỉnh sửa thông tin</h5>
    <button class="btn-close" (click)="closeModals()"></button>
  </div>
  <div class="modal-body">
    <form>
      <div class="mb-2">
        <label>Email:</label>
        <input [(ngModel)]="user!.email" name="email" class="form-control" />
      </div>
      <div class="mb-2">
        <label>Họ:</label>
        <input [(ngModel)]="user!.firstName" name="firstName" class="form-control" />
      </div>
      <div class="mb-2">
        <label>Tên:</label>
        <input [(ngModel)]="user!.lastName" name="lastName" class="form-control" />
      </div>
      <button
        type="button"
        class="btn btn-primary"
        (click)="updateProfile()"
        style="background: linear-gradient(135deg, #1890ff, #40a9ff); border: none;"
      >
        Lưu thay đổi
      </button>
    </form>
  </div>
</div>

<!-- ============================= -->
<!-- Modal: Đổi mật khẩu -->
<!-- ============================= -->
<div class="modal-backdrop" *ngIf="showChangePasswordModal" (click)="closeModals()"></div>
<div class="modal-box" *ngIf="showChangePasswordModal">
  <div class="modal-header">
    <h5>Đổi mật khẩu</h5>
    <button class="btn-close" (click)="closeModals()"></button>
  </div>
  <div class="modal-body">
    <form>
      <div class="mb-2">
        <label>Mật khẩu cũ</label>
          <input type="password" class="form-control" [(ngModel)]="oldPassword" name="oldPassword"/>
      </div>
      <div class="mb-2">
        <label>Mật khẩu mới</label>
          <input type="password" class="form-control" [(ngModel)]="newPassword" name="newPassword"/>
      </div>
      <div class="mb-2">
        <label>Xác nhận mật khẩu mới</label>
          <input type="password" class="form-control" [(ngModel)]="confirmPassword" name="confirmPassword"/>
      </div>
<button type="button" class="btn btn-primary" 
        (click)="changePasswordTest(oldPassword, newPassword, confirmPassword)"
        style="background: linear-gradient(135deg, #1890ff, #40a9ff); border: none;">
  Đổi mật khẩu
</button>    </form>
  </div>
</div>
