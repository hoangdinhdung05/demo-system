<div class="profile-page">
  <div class="container">
    <!-- Header -->
    <div class="page-header">
      <h1><i class="fas fa-user"></i> Thông tin cá nhân</h1>
      <p>Xem và quản lý thông tin tài khoản của bạn</p>
    </div>

    <!-- Loading -->
    <div *ngIf="isLoading" class="loading-container">
      <div class="loading-spinner">
        <i class="fas fa-spinner fa-spin"></i>
        <span>Đang tải thông tin...</span>
      </div>
    </div>

    <!-- Profile Content -->
    <div *ngIf="!isLoading && user" class="profile-content">
      <div class="profile-grid">
        
        <!-- Avatar Section -->
        <div class="profile-card avatar-card">
          <div class="card-header">
            <h3><i class="fas fa-camera"></i> Ảnh đại diện</h3>
          </div>
          <div class="card-body">
            <div class="avatar-section">
              <div class="avatar-container">
                <div class="avatar-large" *ngIf="previewAvatarUrl; else defaultAvatar">
                  <img [src]="previewAvatarUrl" [alt]="user.firstName" />
                  <div class="avatar-overlay" *ngIf="isUploadingAvatar">
                    <i class="fas fa-spinner fa-spin"></i>
                  </div>
                </div>
                <ng-template #defaultAvatar>
                  <div class="user-initial-large">
                    {{ user.firstName.charAt(0) || user.username.charAt(0) || 'U' }}
                  </div>
                </ng-template>
              </div>
              <div class="avatar-actions">
                <label class="btn btn-primary">
                  <i class="fas fa-upload"></i> Thay đổi ảnh
                  <input type="file" 
                         accept="image/*" 
                         (change)="onAvatarFileSelected($event)"
                         style="display: none;">
                </label>
                <button class="btn btn-outline" *ngIf="avatarUrl" (click)="deleteAvatar()">
                  <i class="fas fa-trash"></i> Xóa ảnh
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Personal Information -->
        <div class="profile-card personal-info-card">
          <div class="card-header">
            <h3><i class="fas fa-info-circle"></i> Thông tin cá nhân</h3>
            <button class="btn btn-outline btn-sm" (click)="openEditModal()">
              <i class="fas fa-edit"></i> Chỉnh sửa
            </button>
          </div>
          <div class="card-body">
            <div class="info-grid">
              <div class="info-item">
                <label>Tên đăng nhập</label>
                <span class="value">{{ user.username }}</span>
              </div>
              <div class="info-item">
                <label>Họ</label>
                <span class="value">{{ user.lastName || 'Chưa cập nhật' }}</span>
              </div>
              <div class="info-item">
                <label>Tên</label>
                <span class="value">{{ user.firstName || 'Chưa cập nhật' }}</span>
              </div>
              <div class="info-item">
                <label>Email</label>
                <span class="value">{{ user.email || 'Chưa cập nhật' }}</span>
                <span class="verification-status" *ngIf="user.verifyEmail">
                  <i class="fas fa-check-circle text-success"></i> Đã xác thực
                </span>
                <span class="verification-status" *ngIf="!user.verifyEmail">
                  <i class="fas fa-exclamation-circle text-warning"></i> Chưa xác thực
                </span>
              </div>
              <div class="info-item">
                <label>Số điện thoại</label>
                <span class="value">Chưa cập nhật</span>
              </div>
              <div class="info-item">
                <label>Địa chỉ</label>
                <span class="value">Chưa cập nhật</span>
              </div>
            </div>
          </div>
        </div>
        
    <!-- Error State -->
    <div *ngIf="!isLoading && !user" class="error-state">
      <div class="error-content">
        <i class="fas fa-exclamation-triangle"></i>
        <h3>Không thể tải thông tin</h3>
        <p>Có lỗi xảy ra khi tải thông tin tài khoản. Vui lòng thử lại.</p>
        <button class="btn btn-primary" (click)="loadUserProfile()">
          <i class="fas fa-refresh"></i> Thử lại
        </button>
      </div>
    </div>

  </div>
</div>

<!-- Edit Profile Modal -->
<div class="modal-overlay" *ngIf="showEditModal" (click)="closeEditModal()">
  <div class="modal-container" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3><i class="fas fa-edit"></i> Chỉnh sửa thông tin</h3>
      <button class="close-btn" (click)="closeEditModal()">
        <i class="fas fa-times"></i>
      </button>
    </div>
    
    <form [formGroup]="editProfileForm" (ngSubmit)="onSubmitEditProfile()">
      <div class="modal-body">
        <div class="form-group">
          <label for="firstName">
            Tên <span class="required">*</span>
          </label>
          <input 
            type="text" 
            id="firstName"
            class="form-control"
            [class.is-invalid]="isFieldInvalid(editProfileForm, 'firstName')"
            formControlName="firstName"
            placeholder="Nhập tên của bạn">
          <div class="invalid-feedback" *ngIf="isFieldInvalid(editProfileForm, 'firstName')">
            {{ getFieldError(editProfileForm, 'firstName') }}
          </div>
        </div>

        <div class="form-group">
          <label for="lastName">
            Họ <span class="required">*</span>
          </label>
          <input 
            type="text" 
            id="lastName"
            class="form-control"
            [class.is-invalid]="isFieldInvalid(editProfileForm, 'lastName')"
            formControlName="lastName"
            placeholder="Nhập họ của bạn">
          <div class="invalid-feedback" *ngIf="isFieldInvalid(editProfileForm, 'lastName')">
            {{ getFieldError(editProfileForm, 'lastName') }}
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-outline" (click)="closeEditModal()" [disabled]="isUpdating">
          <i class="fas fa-times"></i> Hủy
        </button>
        <button type="submit" class="btn btn-primary" [disabled]="isUpdating">
          <i class="fas fa-spinner fa-spin" *ngIf="isUpdating"></i>
          <i class="fas fa-save" *ngIf="!isUpdating"></i>
          {{ isUpdating ? 'Đang lưu...' : 'Lưu thay đổi' }}
        </button>
      </div>
    </form>
  </div>
</div>