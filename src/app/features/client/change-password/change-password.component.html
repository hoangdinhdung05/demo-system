<div class="change-password-page">
  <div class="container">
    
    <!-- Header -->
    <div class="page-header">
      <h1><i class="fas fa-key"></i> Đổi mật khẩu</h1>
      <p>Cập nhật mật khẩu để bảo mật tài khoản của bạn</p>
    </div>

    <!-- Change Password Form -->
    <div class="form-container">
      <form [formGroup]="changePasswordForm" (ngSubmit)="onSubmit()" class="password-form">
        
        <!-- Security Notice -->
        <div class="security-notice">
          <div class="notice-content">
            <i class="fas fa-shield-alt"></i>
            <div class="notice-text">
              <h4>Lưu ý bảo mật</h4>
              <ul>
                <li>Sử dụng mật khẩu mạnh với ít nhất 8 ký tự</li>
                <li>Kết hợp chữ hoa, chữ thường, số và ký tự đặc biệt</li>
                <li>Không sử dụng thông tin cá nhân dễ đoán</li>
                <li>Không chia sẻ mật khẩu với bất kỳ ai</li>
              </ul>
            </div>
          </div>
        </div>

        <div class="form-content">
          
          <!-- Current Password -->
          <div class="form-group">
            <label for="currentPassword">Mật khẩu hiện tại <span class="required">*</span></label>
            <div class="password-input-group">
              <input [type]="showCurrentPassword ? 'text' : 'password'"
                     id="currentPassword"
                     formControlName="currentPassword"
                     class="form-control"
                     [class.is-invalid]="isFieldInvalid('currentPassword')"
                     placeholder="Nhập mật khẩu hiện tại">
              <button type="button" 
                      class="password-toggle"
                      (click)="togglePasswordVisibility('current')"
                      tabindex="-1">
                <i [class]="showCurrentPassword ? 'fas fa-eye-slash' : 'fas fa-eye'"></i>
              </button>
            </div>
            <div class="invalid-feedback" *ngIf="isFieldInvalid('currentPassword')">
              {{ getFieldError('currentPassword') }}
            </div>
          </div>

          <!-- New Password -->
          <div class="form-group">
            <label for="newPassword">Mật khẩu mới <span class="required">*</span></label>
            <div class="password-input-group">
              <input [type]="showNewPassword ? 'text' : 'password'"
                     id="newPassword"
                     formControlName="newPassword"
                     class="form-control"
                     [class.is-invalid]="isFieldInvalid('newPassword')"
                     placeholder="Nhập mật khẩu mới">
              <button type="button" 
                      class="password-toggle"
                      (click)="togglePasswordVisibility('new')"
                      tabindex="-1">
                <i [class]="showNewPassword ? 'fas fa-eye-slash' : 'fas fa-eye'"></i>
              </button>
            </div>
            <div class="invalid-feedback" *ngIf="isFieldInvalid('newPassword')">
              {{ getFieldError('newPassword') }}
            </div>
            
            <!-- Password Strength -->
            <div class="password-strength" *ngIf="changePasswordForm.get('newPassword')?.value">
              <div class="strength-meter">
                <div class="strength-bar" [class]="getPasswordStrengthClass()"></div>
              </div>
              <span class="strength-text" [class]="getPasswordStrengthClass()">
                Độ mạnh: {{ getPasswordStrengthText() }}
              </span>
            </div>
          </div>

          <!-- Password Requirements -->
          <div class="password-requirements" *ngIf="changePasswordForm.get('newPassword')?.value">
            <h4>Yêu cầu mật khẩu:</h4>
            <ul class="requirements-list">
              <li [class.met]="passwordRequirements.minLength">
                <i [class]="passwordRequirements.minLength ? 'fas fa-check' : 'fas fa-times'"></i>
                Ít nhất 8 ký tự
              </li>
              <li [class.met]="passwordRequirements.hasUppercase">
                <i [class]="passwordRequirements.hasUppercase ? 'fas fa-check' : 'fas fa-times'"></i>
                Có chữ hoa (A-Z)
              </li>
              <li [class.met]="passwordRequirements.hasLowercase">
                <i [class]="passwordRequirements.hasLowercase ? 'fas fa-check' : 'fas fa-times'"></i>
                Có chữ thường (a-z)
              </li>
              <li [class.met]="passwordRequirements.hasNumber">
                <i [class]="passwordRequirements.hasNumber ? 'fas fa-check' : 'fas fa-times'"></i>
                Có chữ số (0-9)
              </li>
              <li [class.met]="passwordRequirements.hasSpecial">
                <i [class]="passwordRequirements.hasSpecial ? 'fas fa-check' : 'fas fa-times'"></i>
                Có ký tự đặc biệt (!@#$%^&*)
              </li>
            </ul>
          </div>

          <!-- Confirm Password -->
          <div class="form-group">
            <label for="confirmPassword">Xác nhận mật khẩu mới <span class="required">*</span></label>
            <div class="password-input-group">
              <input [type]="showConfirmPassword ? 'text' : 'password'"
                     id="confirmPassword"
                     formControlName="confirmPassword"
                     class="form-control"
                     [class.is-invalid]="isFieldInvalid('confirmPassword')"
                     placeholder="Nhập lại mật khẩu mới">
              <button type="button" 
                      class="password-toggle"
                      (click)="togglePasswordVisibility('confirm')"
                      tabindex="-1">
                <i [class]="showConfirmPassword ? 'fas fa-eye-slash' : 'fas fa-eye'"></i>
              </button>
            </div>
            <div class="invalid-feedback" *ngIf="isFieldInvalid('confirmPassword')">
              {{ getFieldError('confirmPassword') }}
            </div>
          </div>

          <!-- Form Actions -->
          <div class="form-actions">
            <button type="submit" 
                    class="btn btn-primary btn-lg"
                    [disabled]="!changePasswordForm.valid || isLoading">
              <i class="fas fa-spinner fa-spin" *ngIf="isLoading"></i>
              <i class="fas fa-key" *ngIf="!isLoading"></i>
              {{ isLoading ? 'Đang thực hiện...' : 'Đổi mật khẩu' }}
            </button>

            <button type="button" 
                    class="btn btn-outline btn-lg"
                    (click)="changePasswordForm.reset()"
                    [disabled]="isLoading">
              <i class="fas fa-undo"></i> Làm mới
            </button>
          </div>

        </div>

      </form>
    </div>
  </div>
</div>